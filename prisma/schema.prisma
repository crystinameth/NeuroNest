generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "fullTextIndex"]
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Category {
  id         String      @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  companions Companion[]
}

model Companion {
  id           String @id @default(auto()) @map("_id") @db.ObjectId
  userId       String
  userName     String
  src          String
  name         String @db.String
  description  String
  instructions String
  seed         String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  category   Category @relation(fields: [categoryId], references: [id])
  categoryId String   @db.ObjectId

  messages Message[]

  @@index([categoryId])
  @@fulltext([name])
}

enum Role {
  user
  system
}

model Message {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  role      Role
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  companionId String @db.ObjectId
  userId      String

  companion Companion @relation(fields: [companionId], references: [id], onDelete: Cascade) // cascade : if a record in the parent table (the table with the foreign key) is deleted, then all related records in the child table (the table with the foreign key reference) will be automatically deleted as well.

  @@index([companionId])
}
